<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>2-openvpn-deploy.md - Grip</title>
  <link rel="icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEACABoBQAAFgAAACgAAAAQAAAAIAAAAAEACAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAKCgr/FRUX/xYWGP8YGBr/GRkb/xsbHP8dHR7/Hh4f/x4eIP8fHyD/ICAh/yMjJP8kJCX/JiYo/ygoKv8pKSr/LCwu/y0tLv80NDT/QUFC/0ZGR/9MTE7/UFBR/1JSUv9bW1v/XFxc/2BgYP9hYWP/aGhp/2xsbP9ycnL/d3d3/3l5e/98fHz/f3+A/2dn/P9z3a//cNX8/4CAgP+Xl5f/nZ2e/56en/+fn5//n5+h/6amp/+rq6v/rKys/7CvsP+zs7T/uLi5/7u7u/+8vLz/wMDA/8fHx//Kysr/zc3N/9HR0f/d3d3/3t7e/+Xl5f/q6ur/6+vr/+3t7f/z8/P/9fX1//b29v/39/f/+Pj4//n5+f/6+vr/+/v7//z8/P/9/f3//v7+//////8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/NCYmJiYmJiYmJiYmJiYmNCZKSkpKSkpKSkpKSkpKSiYmSkpKRisdRkMbMklKSkomJkpKSSEiNUhEEQwpSUpKJiZKSi8LHhhAPAwBDDZKSiYmSkoWACA7SEc6HAEaSkomJkpKBxI/SkpKSj4ICkpKJiZKSgUTR0pKSkpGDwZKSiYmSkoTED1KSkpKOQQVSkomJkpKKgowMy4sNycIMUpKJiZKSkEZDgkDAgsNH0VKSiYmSkpKQigUBgkXLUhKSkomJkpKSkpKSkpKSkpKSkpKJiYmJiYmJiYmJiYmJiYmJiYmIyUkNDQ0NDQ0NDQ0NDQmOCYmJiYmJiYmJiYmJiYmOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=" />
  <link rel="stylesheet" href="./../../style.css" />
</head>
<body>
  <div class="page">
    <div id="preview-page" class="preview-page" data-autorefresh-url="">

    

      <div role="main" class="main-content">
        <div class="container new-discussion-timeline experiment-repo-nav">
          <div class="repository-content">
            <div id="readme" class="readme boxed-group clearfix announce instapaper_body md">
              
              <article class="markdown-body entry-content" itemprop="text" id="grip-content">
                <h1>
<a id="user-content-instalação-de-servidor-openvpn-no-debian-9" class="anchor" href="#instala%C3%A7%C3%A3o-de-servidor-openvpn-no-debian-9" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Instalação de Servidor OpenVPN no Debian 9</h1>
<p>O objetivo deste tutorial é fazer o deploy de uma VPN usando OpenVPN.</p>
<h4>
<a id="user-content-índice" class="anchor" href="#%C3%ADndice" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Índice</h4>
<ol>
<li><a href="#passo-1">Instalando OpenVPN e EasyRSA</a></li>
<li><a href="#passo-2">Configurando as Variáveis do EasyRSA e Construindo o CA</a></li>
<li><a href="#passo-3">Criando o Server Certificate, Key e Encryption Files</a></li>
<li><a href="#passo-4">Configurando o Serviço OpenVPN</a></li>
<li><a href="#passo-5">Ajustando as Configurações de Rede do Servidor</a></li>
<li><a href="#passo-6">Iniciando e Habilitando o Serviço OpenVPN</a></li>
<li><a href="#passo-7">Configurando Camanda de Autenticação por Usuário e Senha</a></li>
<li><a href="#passo-8">Criando a Infraestrutura de Configuração de Clientes</a></li>
</ol>
<hr>
<h2>
<a id="user-content-passo-1" class="anchor" href="#passo-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Passo 1:</h2>
<h2>
<a id="user-content-instalando-openvpn-e-easyrsa" class="anchor" href="#instalando-openvpn-e-easyrsa" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Instalando OpenVPN e EasyRSA</h2>
<p>De início, instale o OpenVPN.</p>
<pre><code>$ sudo apt update
$ sudo apt install openvpn
</code></pre>
<p>OpenVPN é uma VPN TLS/SSL. Isso significa que utiliza certificados para criptografar o tráfego na rede. Para configuração de certificados confiáveis, deve ser criado seu próprio certificate authority (CA). Para isso, é necessário a versão mais recente do EasyRSA, que será usado para construir a CA public key
infrastructure (PKI).</p>
<p>Então, faça o download da release do EasyRSA. Para isso, localize o link de através da página <a href="https://github.com/OpenVPN/easy-rsa/releases/latest">https://github.com/OpenVPN/easy-rsa/releases/latest</a>, copie-o e faça o download usando o <code>wget</code> como no exemplo a seguir:</p>
<pre><code>$ wget -P ~/ https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.6/EasyRSA-unix-v3.0.6.tgz
</code></pre>
<p>Então extraia o tarball no diretório <code>home</code>:</p>
<pre><code>$ cd ~
$ tar xvf EasyRSA-unix-v3.0.6.tgz
</code></pre>
<p>Renomeie o diretório do arquivo extraído para somente EasyRSA:</p>
<pre><code>$ mv EasyRSA-v3.0.6/ EasyRSA/
</code></pre>
<p>Exclua o arquivo baixado, ele não é mais necessário.</p>
<pre><code>$ rm EasyRSA-unix-v3.0.6.tgz
</code></pre>
<p>Assim está finalizada a instalação da infraestrutura básica da VPN.</p>
<h2>
<a id="user-content-passo-2" class="anchor" href="#passo-2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Passo 2:</h2>
<h2>
<a id="user-content-configurando-as-variáveis-do-easyrsa-e-construindo-o-ca" class="anchor" href="#configurando-as-vari%C3%A1veis-do-easyrsa-e-construindo-o-ca" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configurando as Variáveis do EasyRSA e Construindo o CA</h2>
<p>Vá para o diretório do EasyRSA:</p>
<pre><code>$ cd ~/EasyRSA/
</code></pre>
<p>Dentro do directory existe um arquivo nomeado <code>vars.example</code>. Faça a cópia dele and renomeie-a para <code>vars</code>, sem extensão de arquivo:</p>
<pre><code>$ cp vars.example vars
</code></pre>
<p>Abra o arquivo <code>vars</code>:</p>
<pre><code>$ nano vars
</code></pre>
<p>Encontre as configurações que definem campos padrão para novos certificados. Tem a seguinte aparência no arquivo:</p>
[ ~/EasyRSA/vars ]
<pre><code>. . .
#set_var EASYRSA_REQ_COUNTRY    "US"
#set_var EASYRSA_REQ_PROVINCE   "California"
#set_var EASYRSA_REQ_CITY       "San Francisco"
#set_var EASYRSA_REQ_ORG        "Copyleft Certificate Co"
#set_var EASYRSA_REQ_EMAIL      "me@example.net"
#set_var EASYRSA_REQ_OU         "My Organizational Unit"
. . .
</code></pre>
<p>Descomente essas linhas e altere os valores padrão para os seguintes:</p>
[ ~/EasyRSA/vars ]
<pre><code>. . .
set_var EASYRSA_REQ_COUNTRY     "BR"
set_var EASYRSA_REQ_PROVINCE    "Minas Gerais"
set_var EASYRSA_REQ_CITY        "Perdoes"
set_var EASYRSA_REQ_ORG         "Minasnet Servicos de Provedor de Internet Ltda"
set_var EASYRSA_REQ_EMAIL       "atendimento@minasnet.net"
set_var EASYRSA_REQ_OU          "Centro de Gerenciamento de Redes"
. . .
</code></pre>
<p>Ao final, salve e feche o arquivo.</p>
<p>Dentro do diretório EasyRSA tem um script chamado <code>easyrsa</code> que é usado para executar uma variedade de tarefas envolvendo criação e manutenção do CA. Execute o script com a opção <code>init-pki</code> para iniciar a public key infrastructure:</p>
<pre><code>$ ./easyrsa init-pki
</code></pre>
<p>Entre com os seguintes parâmetros dentro do prompt:</p>
<ul>
<li>
<strong>Passphrase:</strong> ********</li>
<li>
<strong>Common Name:</strong> SERVER-OPENVPN</li>
</ul>
<blockquote>
<p>Mantenha senhas secretas!</p>
</blockquote>
<p>Após isso, execute:</p>
<pre><code>$ ./easyrsa build-ca
</code></pre>
<p>Isso contruirá o CA e criará dois arquivos importantes — <code>ca.crt</code> e <code>ca.key</code> — que compõem os lados público e privado do certificado SSL.</p>
<p>Com isso, o CA está pronto para assinar requisições certificadas.</p>
<h2>
<a id="user-content-passo-3" class="anchor" href="#passo-3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Passo 3:</h2>
<h2>
<a id="user-content-criando-o-server-certificate-key-e-encryption-files" class="anchor" href="#criando-o-server-certificate-key-e-encryption-files" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Criando o Server Certificate, Key e Encryption Files</h2>
<p>Execute <code>easyrsa</code>, desta vez usando a opção <code>gen-req</code> seguida do common name da máquina.</p>
<pre><code>$ ./easyrsa gen-req SERVER-OPENVPN
</code></pre>
<p>Isso cria a private key do servidor no arquivo <code>server.req</code>. Copie o server key para <code>/etc/openvpn/</code>:</p>
<pre><code>$ sudo cp ~/EasyRSA/pki/private/SERVER-OPENVPN.key /etc/openvpn/
</code></pre>
<p>Então assine a requição executando <code>easyrsa</code> com a opção <code>sign-req</code>, seguida pelo <em>request type</em> e o <em>common name</em>:</p>
<pre><code>$ ./easyrsa sign-req server SERVER-OPENVPN
</code></pre>
<p>Depois, copie os arquivos <code>server.crt</code> e <code>ca.crt</code> para <code>/etc/openvpn/</code>:</p>
<pre><code>$ sudo cp pki/issued/SERVER-OPENVPN.crt /etc/openvpn/
$ sudo cp pki/ca.crt /etc/openvpn/
</code></pre>
<p>Crie uma chave forte de Diffie-Hellman para ser usada durante a troca de chaves:</p>
<pre><code>$ ./easyrsa gen-dh
</code></pre>
<p>Isso pode demorar alguns minutos. Após o término, gere uma assinatura HMAC para fortalecer a verificação de integridade TLS do servidor:</p>
<pre><code>$ sudo openvpn --genkey --secret ta.key
</code></pre>
<p>Quando terminar, copie os dois novos arquivos para <code>/etc/openvpn/</code>:</p>
<pre><code>$ sudo cp ta.key /etc/openvpn/
$ sudo cp pki/dh.pem /etc/openvpn/
</code></pre>
<p>Com isso, todos os arquivos de chave de certificação necessários ao servidor forma gerados. A infraestrutura está pronta para gerar as chaves correspondentes para os clientes que irão acessar ao servidor OpenVPN.</p>
<h2>
<a id="user-content-passo-4" class="anchor" href="#passo-4" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Passo 4:</h2>
<h2>
<a id="user-content-configurando-o-serviço-openvpn" class="anchor" href="#configurando-o-servi%C3%A7o-openvpn" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configurando o Serviço OpenVPN</h2>
<p>Inicie copiando o arquivo de exemplo de configuração OpenVPN e extraia-o para servir de base para o servidor:</p>
<pre><code>$ sudo cp /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz /etc/openvpn/
$ sudo gzip -d /etc/openvpn/server.conf.gz
</code></pre>
<p>Abra o arquivo de configuração extraído:</p>
<pre><code>$ sudo nano /etc/openvpn/server.conf
</code></pre>
<p>Encontre a seção HMAC pesquisando pela diretiva <code>tls-auth</code>. Esta linha deve estar descomentada, então remova o ";" para descomentá-la. Abaixo desta linha, adicione o parâmetro <code>key-direction</code>, com valor "0":</p>
[ /etc/openvpn/server.conf ]
<pre><code>tls-auth ta.key 0 # This file is secret
key-direction 0
</code></pre>
<p>Depois, encontre a seção de cryptographic ciphers pesquisando pelas linhas comentadas <code>cipher</code>. A cifra <code>AES-256-CBC</code> oferece bom nível de criptografia e é bem suportada. Novamente, esta linha deve ser descomentada, remova o ";" se houver. Abaixo dela, adicione a diretiva <code>auth</code> para selecionar o algoritmo HMAC message digest, sendo <code>SHA256</code> uma boa escolha:</p>
[ /etc/openvpn/server.conf ]
<pre><code>cipher AES-256-CBC
auth SHA256
</code></pre>
<p>Depois, encontre a linha contendo a diretiva <code>dh</code> que define os parâmetros de Diffie-Hellman. Se necessário, mude o nome de arquivo listado aqui removendo o <code>2048</code> de forma que fique com o nome do arquivo gerado anteriormente:</p>
[ /etc/openvpn/server.conf ]
<pre><code>dh dh.pem
</code></pre>
<p>Encontre as configurações <code>user</code> e <code>group</code> e remova o ";" no início da linha:</p>
[ /etc/openvpn/server.conf ]
<pre><code>user nobody
group nogroup
</code></pre>
<p>Modifique as linhas de <code>cert</code> e <code>key</code> para os apropriados arquivos <code>.crt</code> e <code>.key</code>, devendo ficar desta forma:</p>
[ /etc/openvpn/server.conf ]
<pre><code>cert SERVER-OPENVPN.crt
key SERVER-OPENVPN.key
</code></pre>
<p>Também altere o protocolo para <code>tcp</code>, descomentando <code>tcp</code> e comentando <code>udp</code>:</p>
[ /etc/openvpn/server.conf ]
<pre><code>proto tcp;
;proto udp;
</code></pre>
<p>Após alterar para TCP, será necessário mudar o valor da diretiva <code>explicit-exit-notify</code> de 1 para 0, pois ela é utilizada apenas pelo UDP. Não mudar esse valor pode causar erro no serviço OpenVPN:</p>
[ /etc/openvpn/server.conf ]
<pre><code>explicit-exit-notify 0
</code></pre>
<p>As configurações feitas até aqui não força o tráfego dos dados pela VPN após a conexão do cliente. Para forçar os clientes a usarem o túnel da VPN, é necessário proceder com as configurações a seguir.</p>
<p>Encontre a seção <code>redirect-gateway</code> e remova o ";" no início da linha para deixá-la descomentada:</p>
[ /etc/openvpn/server.conf ]
<pre><code>push "redirect-gateway def1 bypass-dhcp"
</code></pre>
<p>Abaixo dela, encontre a seção <code>dhcp-option</code>. Novamente, remova o ";" e deixe da seguinte forma:</p>
[ /etc/openvpn/server.conf ]
<pre><code>push "dhcp-option DNS 177.66.48.12"
push "dhcp-option DNS 177.66.48.13"
</code></pre>
<p>As mudanças feitas no arquivo de exemplo <code>server.conf</code> até aqui são necessárias para o pleno funcionamento do servidor e da conexão.</p>
<h2>
<a id="user-content-passo-5" class="anchor" href="#passo-5" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Passo 5:</h2>
<h2>
<a id="user-content-ajustando-as-configurações-de-rede-do-servidor" class="anchor" href="#ajustando-as-configura%C3%A7%C3%B5es-de-rede-do-servidor" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Ajustando as Configurações de Rede do Servidor</h2>
<p>Ajuste a configuração padrão de redirecionamento de IP do servidor modificando o arquivo <code>/etc/sysctl.conf</code>:</p>
<pre><code>$ sudo nano /etc/sysctl.conf
</code></pre>
<p>Dentro, procure pela linha comentada que coloca <code>net.ipv4.ip_forward</code>. Remova o "#" do início da linha para descomentar essa configuração:</p>
[ /etc/sysctl.conf ]
<pre><code>net.ipv4.ip_forward=1
</code></pre>
<p>Salve e feche o arquivo.</p>
<p>Para carregar as novas configurações para a sessão atual, digite:</p>
<pre><code>$ sudo sysctl -p
</code></pre>
<p>Algumas das configurações do firewall devem ser modificadas para habilitar o mascaramento. Antes de abrir as configurações do firewall e habilitar o mascaramento, primeiramente deveser encontrada a interface de rede pública do servidor. Para isso, digite:</p>
<pre><code>$ ip route | grep default
</code></pre>
<p>Com a interface associada à sua rota padrão, abra o arquivo <code>/etc/ufw/before.rules</code> para adicionar a configuração necessária:</p>
<pre><code>$ sudo nano /etc/ufw/before.rules
</code></pre>
<p>No início do arquivo, adicione as linhas abaixo:</p>
[ /etc/ufw/before.rules ]
<pre><code>#
# rules.before
#
# Rules that should be run before the ufw command line added rules. Custom
# rules should be added to one of these chains:
#   ufw-before-input
#   ufw-before-output
#   ufw-before-forward
#

# START OPENVPN RULES
# NAT table rules
*nat
:POSTROUTING ACCEPT [0:0] 
# Allow traffic from OpenVPN client to eth0 (change to the interface you discovered!)
-A POSTROUTING -s 10.8.0.0/8 -o eth0 -j MASQUERADE
COMMIT
# END OPENVPN RULES

# Don't delete these required lines, otherwise there will be errors
*filter
. . .
</code></pre>
<p>Salve e feche o arquivo quando concluir.</p>
<p>Depois, voce tem que configurar o UFW para permitir redirecionamento de pacotes por padrão. Para isso, abra o arquivo<code>/etc/default/ufw</code>:</p>
<pre><code>$ sudo nano /etc/default/ufw
</code></pre>
<p>Dentro, encontre a diretiva <code>DEFAULT_FORWARD_POLICY</code> e modifique o valor de <code>DROP</code> para <code>ACCEPT</code>:</p>
[ /etc/default/ufw ]
<pre><code>DEFAULT_FORWARD_POLICY="ACCEPT"
</code></pre>
<p>Salve e feche o arquivo.</p>
<p>Agora, ajuste o firewall para habilitar o tráfego do OpenVPN:</p>
<pre><code>$ sudo ufw allow 1194/tcp
</code></pre>
<p>Após adicionar a regra no firewall, desabilite e reabilite o UFW para reiniciá-lo:</p>
<pre><code>$ sudo ufw disable
$ sudo ufw enable
</code></pre>
<p>O servidor está agora pronto para lidar com tráfego da VPN.</p>
<h2>
<a id="user-content-passo-6" class="anchor" href="#passo-6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Passo 6:</h2>
<h2>
<a id="user-content-iniciando-e-habilitando-o-serviço-openvpn" class="anchor" href="#iniciando-e-habilitando-o-servi%C3%A7o-openvpn" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Iniciando e Habilitando o Serviço OpenVPN</h2>
<p>O servidor está pronto para inciar o serviço OpenVPN. Antes de iniciá-lo, o passphrase é pedido pelo <code>systemd</code>, apenas digite o seguinte comando e preencha o prompt com o passphrase definido anteriormente:</p>
<pre><code>$ sudo systemd-tty-ask-password-agent
</code></pre>
<p>Inicie o servidor OpenVPN:</p>
<pre><code>$ sudo systemctl start openvpn@server
</code></pre>
<p>Verifique se o serviço foi iniciado com sucesso:</p>
<pre><code>$ sudo systemctl status openvpn@server
</code></pre>
<p>Você também pode verificar se a interface do túnel OpenVPN <code>tun0</code> está disponível:</p>
<pre><code>$ ip addr show tun0
</code></pre>
<p>O servidor OpenVPN em execução neste momento, se nenhum erro tiver ocorrido. Devido ao passphrase definido no EasyRSA, não é possível iniciar o serviço automaticamente no boot, devendo, portantos, ser iniciado manualmente com os comandos definidos nesta seção.</p>
<h2>
<a id="user-content-passo-7" class="anchor" href="#passo-7" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Passo 7:</h2>
<h2>
<a id="user-content-configurando-camanda-de-autenticação-por-usuário-e-senha" class="anchor" href="#configurando-camanda-de-autentica%C3%A7%C3%A3o-por-usu%C3%A1rio-e-senha" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configurando Camanda de Autenticação por Usuário e Senha</h2>
<p>Até este momento, o servidor OpenVPN em execução funciona pela autenticação por troca de chaves. Para aumentar o nível de segurança do servidor OpenVPN, será adicionado mais uma camada de autenticação, exigindo, além das chaves, login e senha através do Linux PAM.</p>
<p>Para isso, modifique o arquivo <code>server.conf</code> para habilitar o plugin do PAM:</p>
<pre><code>$ sudo nano /etc/openvpn/server.conf 
</code></pre>
<p>Adicone ao final dele a seguinte linha:</p>
[ /etc/openvpn/server.conf ]
<pre><code>plugin /usr/lib/openvpn/openvpn-plugin-auth-pam.so login
</code></pre>
<p>Salve e feche o arquivo. Após, reinicie o servidor para que o novo módulo seja carregado corretamente:</p>
<pre><code>$ sudo reboot 
</code></pre>
<p>Após reiniciar, execute o script de início do servidor OpenVPN, que está no diretório do administrador, já que não é possível iniciá-lo automaticamente:</p>
<pre><code>$ ./start-openvpn
</code></pre>
<p>Digite o passphrase e pronto. Finalmente, verifique se o servidor está em produção:</p>
<pre><code>$ sudo systemctl status openvpn@server
</code></pre>
<p>Se o status não indicar nenhum erro, a VPN está pronta para uso.</p>
<h2>
<a id="user-content-passo-8" class="anchor" href="#passo-8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Passo 8:</h2>
<h2>
<a id="user-content-criando-a-infraestrutura-de-configuração-de-clientes" class="anchor" href="#criando-a-infraestrutura-de-configura%C3%A7%C3%A3o-de-clientes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Criando a Infraestrutura de Configuração de Clientes</h2>
<p>Primeiramente, faça o download da base de configurações de gerenciamento de clientes OpenVPN:</p>
<pre><code>$ wget -P /tmp/ https://williamabreu.github.io/MNET-tutorials/openvpn/download/mnet-openvpn-configs.tar.gz
</code></pre>
<p>Depois, extraia o tarball:</p>
<pre><code>$ cd /tmp/
$ tar xvf mnet-openvpn-configs.tar.gz
</code></pre>
<p>Entre no diretório extraído e execute o autoconfigurador:</p>
<pre><code>$ cd mnet-openvpn-configs/
$ ./configure
</code></pre>
<p>Agora com a base de configurações de clientes OpenVPN instaladas em <code>~/client-configs/</code>, navegue até o diretório raíz do administrador:</p>
<pre><code>$ cd ~
</code></pre>
<p>Neste diretório estão os scripts para facilitar a criação de usuários e início do servidor OpenVPN, são os executáveis <code>add-openvpn-user</code> e <code>start-openvpn</code>.</p>
<p>Para adicionar um novo usuário, como exemplo o de username sendo <code>client1</code>, execute o comando:</p>
<pre><code>./add-openvpn-user client1
</code></pre>
<p>Preencha os dados do prompt corretamente.</p>
<p>Assim que terminar o processo, o arquivo que deve ser enviado para o cliente para que ele possa acessar à VPN está disponível em <code>~/client-configs/ovpn-files/</code>, sendo o arquivo cujo nome é o respectivo username com extensão <code>.ovpn</code>. Como no exemplo, o arquivo seria <code>client1.ovpn</code>. Esse arquivo deve ser enviado por um meio seguro e não pode ser compartilhado.</p>
<p>Repita este último procedimento sempre que for criar um novo usuário da VPN.</p>
<blockquote>
<p>PRONTO!</p>
</blockquote>
<h3>
<a id="user-content-referências" class="anchor" href="#refer%C3%AAncias" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Referências</h3>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-an-openvpn-server-on-debian-9" rel="nofollow">https://www.digitalocean.com/community/tutorials/how-to-set-up-an-openvpn-server-on-debian-9</a></li>
<li><a href="https://www.youtube.com/watch?v=V6DGD4QRXVU" rel="nofollow">https://www.youtube.com/watch?v=V6DGD4QRXVU</a></li>
</ul>

              </article>
            </div>
          </div>
        </div>
      </div>

    

  </div>
  <div>&nbsp;</div>
  </div>
  <script src="./../../script.js"></script>
</body>
</html>